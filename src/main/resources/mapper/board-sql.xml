<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<select id="selectBoardList" parameterType="hashmap" resultType="hashmap">
		SELECT
			B_NO,
			B_SUBJECT,
			B_NAME,
			B_DATE,
			B_READCOUNT
		FROM
			BOARD
		<where>
			<if test="searchKey != null and searchKey == 0">
				B_SUBJECT like '%' || #{searchWord} || '%'
			</if>
			<if test="searchKey != null and searchKey == 1">
				B_SUBJECT like '%' || #{searchWord} || '%' or B_CONTENT like '%' ||#{searchWord} || '%'
			</if>
			<if test="searchKey != null and searchKey == 2">
				B_NAME like '%' || #{searchWord} || '%'
			</if>
		</where>
		ORDER BY
			B_NO DESC
	</select>

	<select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap">
		SELECT
			B_NO,
			B_KIND,
			B_NAME,
			B_EMAIL,
			B_COMPANY,
			B_CATEGORY,
			B_SUBJECT,
			B_CONTENT,
			B_FAV_AREA,
			B_FAV_FIELD,
			B_PAYMENT,
			B_DATE,
			B_READCOUNT,
			M_NO
		FROM
			BOARD
		WHERE
			B_NO = #{B_NO}
	</select>
	
	<select id="selectCmtList" parameterType="hashmap" resultType="hashmap">
		SELECT
			C_NO,
			C_NAME,
			C_CONTENT,
			C_DATE,
			C_MY_NO,
			O_NO,
			B_NO,
			M_NO
		FROM
			COMMENTS
		WHERE
			B_NO = #{B_NO}
		ORDER BY
			C_NO DESC
	</select>	

	<update id="updateBoardReadCount" parameterType="hashmap">
        UPDATE BOARD
        SET
            B_READCOUNT = NVL(B_READCOUNT,0)+1
        WHERE
            B_NO = #{B_NO}
	</update>

	<insert id="insertCmt" parameterType="hashmap">
		INSERT INTO COMMENTS
		(
			C_NO,
			C_NAME,
			C_CONTENT,
			C_DATE,
			B_NO,
			M_NO
		)
		VALUES
		(
			COMMENTS_SEQ.NEXTVAL,
			#{C_NAME},
			#{C_CONTENT},
			SYSDATE,
			#{B_NO},
			#{M_NO}
		)
	</insert>
	
	<delete id="deleteCmt" parameterType="hashmap">
		DELETE FROM 
			COMMENTS 
		WHERE C_NO=#{C_NO} and M_NO=#{M_NO}
	</delete>
	
</mapper>